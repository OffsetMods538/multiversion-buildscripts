import org.codehaus.groovy.runtime.GStringImpl

import java.nio.file.Files

ext {
    neo_mod_id = project.mod_id.replace('-', '_');

    versionPrefix = project.mod_version
    if (!Boolean.parseBoolean(System.getenv("IS_RELEASE"))) {
        String preReleaseVersion = System.currentTimeMillis()

        if (Boolean.parseBoolean(System.getenv("PRESERVE_PRERELEASE_VERSION"))) {
            var preReleaseVersionFile = file("preReleaseVersion.txt").toPath()
            if (Files.exists(preReleaseVersionFile)) preReleaseVersion = Files.readString(preReleaseVersionFile)
            Files.writeString(preReleaseVersionFile, preReleaseVersion)
        }

        var separator = "-"
        if (versionPrefix.contains("-")) separator = "."
        versionPrefix = "${versionPrefix}${separator}${preReleaseVersion}" as GStringImpl
    }
    final String versionSuffix = System.getenv("VERSION_SUFFIX")
    versionPrefix = "${versionPrefix}${versionSuffix == null ? "+local" : versionSuffix.isEmpty() ? "" : "+${versionSuffix}"}" as GStringImpl

    System.out.println("Version Prefix: " + versionPrefix)
}
